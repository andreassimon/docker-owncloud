owncloud:
  build: .
  expose:
   - "80"
  volumes:
   - docker_volumes/data:/var/www/html/data
#   - docker_volumes/config:/var/www/html/config
  links:
   - mysql
   - etcd

mysql:
  image: mysql
  expose:
   - "3306"
  environment:
    MYSQL_DATABASE: owncloud
    MYSQL_USER: owncloud
    MYSQL_PASSWORD: password
    MYSQL_ROOT_PASSWORD: BFPTkyq8IRfP-random
    # MYSQLD_ARGS:
  volumes:
   - docker_volumes/mysql:/var/lib/mysql

haproxy:
#  image: tutum/haproxy
  image: haproxy-confd
  ports:
    - "443:443"
    - "80:80"
  environment:
    SSL_CERT:
  links:
    - owncloud
    - etcd

etcd:
  image: coreos/etcd
  name: etcd
  ports:
    - "4001:4001"
    - "7001:7001"
  # command: /opt/etcd/bin/etcd -discovery https://discovery.etcd.io/fc9c7e8433b16662c10de2a23ea2a663 -addr 0.0.0.0:4001
  # command: /opt/etcd/bin/etcd -discovery https://discovery.etcd.io/fc9c7e8433b16662c10de2a23ea2a663 -bind-addr etcd:4001
  # command: /opt/etcd/bin/etcd -discovery https://discovery.etcd.io/83954b801d881e773cf6746ec288b4cb -addr etcd:4001 -bind-addr 0.0.0.0:4001
  # command: /opt/etcd/bin/etcd -no-sync -discovery https://discovery.etcd.io/83954b801d881e773cf6746ec288b4cb -addr etcd:4001 -bind-addr 0.0.0.0:4001
  # command: -discovery https://discovery.etcd.io/83954b801d881e773cf6746ec288b4cb -addr etcd:4001 -bind-addr 0.0.0.0:4001
  command: -addr etcd:4001

# $ fig run haproxy bash
# $ curl http://etcd:4001/v2/keys/

# $ curl -XPUT http://etcd:4001/v2/keys/owncloud -d dir=true
# $ curl -XPUT http://etcd:4001/v2/keys/owncloud/`hostname -s` -d dir=true
# $ curl -XPUT http://etcd:4001/v2/keys/owncloud/`hostname -s`/ip -d value=`hostname -i`

# $ curl http://etcd:4001/v2/keys/owncloud


# $ sudo make-ssl-cert generate-default-snakeoil
# $ sudo make-ssl-cert generate-default-snakeoil --force-overwrite
# $ less /usr/sbin/make-ssl-cert
#
# /etc/ssl/certs/ssl-cert-snakeoil.pem
# /etc/ssl/private/ssl-cert-snakeoil.key

# bash$
#   sudo bash -c 'SSL_CERT="`cat /etc/ssl/certs/ssl-cert-snakeoil.pem`\n`cat /etc/ssl/private/ssl-cert-snakeoil.key`" fig up'
